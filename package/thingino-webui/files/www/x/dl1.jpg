#!/bin/sh
# BusyBox httpd CGI for snapshot channel 0
# Optional query: q=85 for JPEG quality override

echo "Content-Type: image/jpeg"
echo "Content-Disposition: attachment; filename=ch0-$(date +%s).jpg"
echo

Q=""
case "$QUERY_STRING" in
	q=*) Q=${QUERY_STRING#q=} ;;
	*) Q="" ;;
esac

if [ -n "$Q" ]; then
	prudyntctl snapshot -c 1 -q "$Q"
else
	prudyntctl snapshot -c 1
fi
