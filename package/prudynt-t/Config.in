config BR2_PACKAGE_PRUDYNT_T
	bool "Prudynt-T streamer"
	depends on !BR2_SOC_FAMILY_INGENIC_A1
	select BR2_PACKAGE_FAAC
	select BR2_PACKAGE_INGENIC_LIB
	select BR2_PACKAGE_INGENIC_MUSL if BR2_TOOLCHAIN_USES_MUSL
	select BR2_PACKAGE_LIBEXECINFO if BR2_TOOLCHAIN_USES_MUSL
	select BR2_PACKAGE_LIBHELIX_AAC
	select BR2_PACKAGE_LIBHELIX_MP3
	select BR2_PACKAGE_LIBFLAC
	select BR2_PACKAGE_LIBSCHRIFT
	select BR2_PACKAGE_OPUS
	select BR2_PACKAGE_THINGINO_JCT
	select BR2_PACKAGE_THINGINO_LIVE555
	select BR2_PACKAGE_THINGINO_ONVIF
	select BR2_PACKAGE_THINGINO_SOUNDS
	help
	  Video streamer for Ingenic T-series.
	  Now uses JSON configuration format with json-c library.

	  https://github.com/gtxaspec/prudynt-t

if BR2_PACKAGE_PRUDYNT_T

choice
	prompt "Prudynt linking mode"
	default BR2_PACKAGE_PRUDYNT_T_DYNAMIC
	help
	  Choose how Prudynt links against its dependencies.

	  Dynamic: All libraries linked dynamically (smallest binary, more .so files)
	  Hybrid: live555 static, others dynamic (balanced, ~700KB flash savings)
	  Static: All libraries static (largest binary, no .so files needed)

config BR2_PACKAGE_PRUDYNT_T_DYNAMIC
	bool "Dynamic linking"
	help
	  Link all libraries dynamically. This produces the smallest binary
	  but requires all shared libraries (.so) on the target filesystem.

	  Binary size: ~2.3MB
	  Shared libs: ~2MB
	  Total: ~4.3MB

config BR2_PACKAGE_PRUDYNT_T_HYBRID
	bool "Hybrid linking (live555 static)"
	help
	  Statically link live555 libraries (RTSP/RTP stack) while keeping
	  other libraries dynamic. This is a balanced approach that saves
	  flash space by embedding only the actually-used live555 code.

	  Binary size: ~1.6MB (includes live555)
	  Shared libs: ~600KB (audio codecs, etc.)
	  Total: ~2.2MB
	  Flash savings: ~700KB vs dynamic

	  Recommended for most deployments.

config BR2_PACKAGE_PRUDYNT_T_STATIC
	bool "Static linking (full)"
	help
	  Statically link all libraries except system libraries (libc, libimp).
	  This produces the largest binary but requires minimal .so files.

	  Binary size: ~4MB+
	  Shared libs: minimal (system only)
	  Total: ~4.5MB

	  Only use if you need complete library independence.

endchoice

config BR2_PACKAGE_PRUDYNT_T_FFMPEG
	bool "Enable FFmpeg integration (parsers/bitstream filters)"
	depends on BR2_PACKAGE_PRUDYNT_T
	select BR2_PACKAGE_THINGINO_FFMPEG
	help
	  Enable FFmpeg-based H.264/H.265 parsing and bitstream filters (AUD insertion,
	  extract_extradata). Prudynt will link against the FFmpeg built by the
	  thingino-ffmpeg package in Buildroot.

config BR2_PACKAGE_PRUDYNT_T_DEBUG
	bool "Enable debug build"
	depends on BR2_PACKAGE_PRUDYNT_T
	select BR2_PACKAGE_GDB
	help
	  Enable debug build of Prudynt-T with memory safety checking.

	  This option enables:
	  - Debug symbols (-g)
	  - Disabled optimizations (-O0)
	  - AddressSanitizer for memory error detection (when supported)
	  - UndefinedBehaviorSanitizer for runtime checks
	  - Preserved debug information (no symbol stripping)

	  IMPORTANT: Debug builds require NFS configuration!

	  Debug components are installed to the NFS share to keep firmware
	  images small:
	  - Unstripped binary: $(THINGINO_NFS)/usr/bin/prudynt-debug
	  - Debug symbols: $(THINGINO_NFS)/usr/lib/debug/usr/bin/prudynt.debug
	  - Debug tools: $(THINGINO_NFS)/usr/bin/prudynt-*

	  The firmware image will only contain the stripped binary at
	  /usr/bin/prudynt to maintain minimal size for camera deployment.

	  To use debug builds:
	  1. Set BR2_THINGINO_NFS in buildroot configuration
	  2. Mount NFS on camera: mount -t nfs server:/path /mnt/nfs
	  3. Access debug tools: /mnt/nfs/usr/bin/prudynt-debug

	  Use this for development, debugging memory issues, and
	  troubleshooting crashes on camera hardware.

	  WARNING: Debug builds are significantly larger and slower.
	  Only use for development and debugging purposes.

comment "prudynt-t debug build requires NFS configuration! Set BR2_THINGINO_NFS to your NFS mount point (e.g., /nfs)."
	depends on BR2_PACKAGE_PRUDYNT_T_DEBUG
	depends on BR2_THINGINO_NFS = ""

config BR2_PACKAGE_PRUDYNT_T_WEBSOCKETS
	bool "Enable WebSocket UI/control server"
	depends on BR2_PACKAGE_PRUDYNT_T
	select BR2_PACKAGE_LIBWEBSOCKETS
	help
	  Build the libwebsockets-based configuration UI and API server.
	  Disable this if you only need RTSP/HTTP interfaces and want to drop
	  the libwebsockets dependency.

config BR2_PACKAGE_PRUDYNT_T_PREBUFFER
	bool "Enable pre-trigger buffer for motion events"
	depends on BR2_PACKAGE_PRUDYNT_T
	default y if BR2_SOC_FAMILY_INGENIC_T31
	default y if BR2_SOC_FAMILY_INGENIC_T40
	default y if BR2_SOC_FAMILY_INGENIC_T41
	default n
	help
	  Enable pre-trigger video buffer to capture frames before motion
	  detection triggers. This provides context for motion events by
	  including 2-10 seconds of video before the trigger occurred.

	  Memory requirements (per channel):
	  - Full frames (3s): ~1.5-2MB RAM
	  - Keyframe-only (3s): ~0.5MB RAM
	  - Binary size: +3-4KB

	  Recommended for:
	  - 64MB+ devices (T31, T40, T41): Enable (default)
	  - 32MB devices (T20, T21, T10): Disable to save memory

	  When disabled, this feature is completely removed at compile time
	  with zero overhead. Motion detection still works without prebuffer,
	  but recordings will only capture frames after the trigger.

config BR2_PACKAGE_PRUDYNT_T_WEBRTC
	bool "WebRTC support"
	depends on BR2_PACKAGE_PRUDYNT_T
	depends on BR2_TOOLCHAIN_HAS_THREADS
	depends on !BR2_STATIC_LIBS
#	select BR2_PACKAGE_LIBPEER
	select BR2_PACKAGE_LIBDATACHANNEL
	help
	  Enable WebRTC real-time streaming support for Prudynt-T.
	  Adds WebRTC peer-to-peer streaming capabilities using libpeer.

	  This feature allows direct browser-to-camera streaming without
	  requiring RTSP clients, enabling modern web applications to
	  access camera streams directly.

comment "WebRTC support needs a toolchain w/ threads, dynamic library"
	depends on BR2_PACKAGE_PRUDYNT_T && (!BR2_TOOLCHAIN_HAS_THREADS || BR2_STATIC_LIBS)

endif # BR2_PACKAGE_PRUDYNT_T
