$(info --- FILE: external.mk ---)

# 0x0800000, 8M, 8_388_608
SIZE_8M  := 8388608
# 0x1000000, 16M, 16_777_216
SIZE_16M := 16777216
# 0x2000000, 32M, 33_554_432
SIZE_32M := 33554432

SOC_VENDOR := ingenic

ifeq ($(BR2_SOC_INGENIC_DUMMY),y)
SOC_MODEL := t31x
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T10L),y)
SOC_MODEL := t10l
SOC_RAM := 64
BR2_SOC_INGENIC_T10=y
else ifeq ($(BR2_SOC_INGENIC_T10N),y)
SOC_MODEL := t10n
SOC_RAM := 64
BR2_SOC_INGENIC_T10=y
else ifeq ($(BR2_SOC_INGENIC_T10A),y)
SOC_MODEL := t10a
SOC_RAM := 64
BR2_SOC_INGENIC_T10=y
else ifeq ($(BR2_SOC_INGENIC_T20L),y)
SOC_MODEL := t20l
SOC_RAM := 64
BR2_SOC_INGENIC_T20=y
else ifeq ($(BR2_SOC_INGENIC_T20N),y)
SOC_MODEL := t20n
SOC_RAM := 64
BR2_SOC_INGENIC_T20=y
else ifeq ($(BR2_SOC_INGENIC_T20X),y)
SOC_MODEL := t20x
SOC_RAM := 128
BR2_SOC_INGENIC_T20=y
else ifeq ($(BR2_SOC_INGENIC_T21L),y)
SOC_MODEL := t21l
SOC_RAM := 64
BR2_SOC_INGENIC_T21=y
else ifeq ($(BR2_SOC_INGENIC_T21N),y)
SOC_MODEL := t21n
SOC_RAM := 64
BR2_SOC_INGENIC_T21=y
else ifeq ($(BR2_SOC_INGENIC_T21X),y)
SOC_MODEL := t21x
SOC_RAM := 128
BR2_SOC_INGENIC_T21=y
else ifeq ($(BR2_SOC_INGENIC_T21Z),y)
SOC_MODEL := t21zn
SOC_RAM := 64
BR2_SOC_INGENIC_T21=y
else ifeq ($(BR2_SOC_INGENIC_T21ZL),y)
SOC_MODEL := t21zl
SOC_RAM := 64
BR2_SOC_INGENIC_T21=y
else ifeq ($(BR2_SOC_INGENIC_T23N),y)
SOC_MODEL := t23n
SOC_RAM := 64
BR2_SOC_INGENIC_T23=y
else ifeq ($(BR2_SOC_INGENIC_T23ZN),y)
SOC_MODEL := t23zn
SOC_RAM := 64
BR2_SOC_INGENIC_T23=y
else ifeq ($(BR2_SOC_INGENIC_T30L),y)
SOC_MODEL := t30l
SOC_RAM := 64
BR2_SOC_INGENIC_T30=y
else ifeq ($(BR2_SOC_INGENIC_T30N),y)
SOC_MODEL := t30n
SOC_RAM := 64
BR2_SOC_INGENIC_T30=y
else ifeq ($(BR2_SOC_INGENIC_T30X),y)
SOC_MODEL := t30x
SOC_RAM := 128
BR2_SOC_INGENIC_T30=y
else ifeq ($(BR2_SOC_INGENIC_T30A),y)
SOC_MODEL := t30a
SOC_RAM := 128
BR2_SOC_INGENIC_T30=y
else ifeq ($(BR2_SOC_INGENIC_T31L),y)
SOC_MODEL := t31l
SOC_RAM := 64
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T31LC),y)
SOC_MODEL := t31lc
SOC_RAM := 64
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T31N),y)
SOC_MODEL := t31n
SOC_RAM := 64
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T31X),y)
SOC_MODEL := t31x
SOC_RAM := 128
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T31A),y)
SOC_MODEL := t31a
SOC_RAM := 128
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T31AL),y)
SOC_MODEL := t31al
SOC_RAM := 128
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T31ZL),y)
SOC_MODEL := t31zl
SOC_RAM := 64
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T31ZX),y)
SOC_MODEL := t31zx
SOC_RAM := 128
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T31XL),y)
SOC_MODEL := t31xl
SOC_RAM := 64
BR2_SOC_INGENIC_T31=y
else ifeq ($(BR2_SOC_INGENIC_T40N),y)
SOC_MODEL := t40n
SOC_RAM := 128
BR2_SOC_INGENIC_T40=y
else ifeq ($(BR2_SOC_INGENIC_T40XP),y)
SOC_MODEL := t40xp
SOC_RAM := 256
BR2_SOC_INGENIC_T40=y
else ifeq ($(BR2_SOC_INGENIC_T40A),y)
SOC_MODEL := t40a
SOC_RAM := 128
BR2_SOC_INGENIC_T40=y
else ifeq ($(BR2_SOC_INGENIC_T41LQ),y)
SOC_MODEL := t41lq
SOC_RAM := 64
BR2_SOC_INGENIC_T41=y
else ifeq ($(BR2_SOC_INGENIC_T41NQ),y)
SOC_MODEL := t41nq
SOC_RAM := 128
BR2_SOC_INGENIC_T41=y
else ifeq ($(BR2_SOC_INGENIC_T41ZL),y)
SOC_MODEL := t41zl
SOC_RAM := 64
BR2_SOC_INGENIC_T41=y
else ifeq ($(BR2_SOC_INGENIC_T41ZN),y)
SOC_MODEL := t41zn
SOC_RAM := 128
BR2_SOC_INGENIC_T41=y
else ifeq ($(BR2_SOC_INGENIC_T41ZX),y)
SOC_MODEL := t41zx
SOC_RAM := 256
BR2_SOC_INGENIC_T41=y
else ifeq ($(BR2_SOC_INGENIC_T41A),y)
SOC_MODEL := t41a
SOC_RAM := 512
BR2_SOC_INGENIC_T41=y
endif

ifeq ($(BR2_SOC_INGENIC_T10),y)
SOC_FAMILY := t10
SDK_VERSION := 3.12.0
KERNEL_BRANCH := $(SOC_VENDOR)-t31
else ifeq ($(BR2_SOC_INGENIC_T20),y)
SOC_FAMILY := t20
SDK_VERSION := 3.12.0
KERNEL_BRANCH := $(SOC_VENDOR)-t31
else ifeq ($(BR2_SOC_INGENIC_T21),y)
SOC_FAMILY := t21
SDK_VERSION := 1.0.33
KERNEL_BRANCH := $(SOC_VENDOR)-t31
else ifeq ($(BR2_SOC_INGENIC_T23),y)
SOC_FAMILY := t23
SDK_VERSION := 1.1.0
KERNEL_BRANCH := $(SOC_VENDOR)-t31
else ifeq ($(BR2_SOC_INGENIC_T30),y)
SOC_FAMILY := t30
SDK_VERSION := 1.0.5
KERNEL_BRANCH := $(SOC_VENDOR)-t31
else ifeq ($(BR2_SOC_INGENIC_T31),y)
SOC_FAMILY := t31
SDK_VERSION := 1.1.6
KERNEL_BRANCH := $(SOC_VENDOR)-t31
else ifeq ($(BR2_SOC_INGENIC_T40),y)
SOC_FAMILY := t40
SDK_VERSION := 1.2.0
KERNEL_BRANCH := $(SOC_VENDOR)-t40
else ifeq ($(BR2_SOC_INGENIC_T41),y)
SOC_FAMILY := t41
SDK_VERSION := 1.2.0
KERNEL_BRANCH := $(SOC_VENDOR)-t41
endif

SENSOR_MODEL = $(subst ",,$(BR2_SENSOR_MODEL))

ifeq ($(FLASH_SIZE_8),y)
$(info FLASH_SIZE_8=$(FLASH_SIZE_8))
FLASH_SIZE := $(SIZE_8M)
else ifeq ($(FLASH_SIZE_16),y)
$(info FLASH_SIZE_16=$(FLASH_SIZE_16))
FLASH_SIZE := $(SIZE_16M)
else ifeq ($(FLASH_SIZE_32),y)
$(info FLASH_SIZE_32=$(FLASH_SIZE_32))
FLASH_SIZE := $(SIZE_32M)
else
FLASH_SIZE := $(SIZE_8M)
endif
$(info FLASH_SIZE=$(FLASH_SIZE))

# default to older kernel if none set
ifneq ($(KERNEL_VERSION_3)$(KERNEL_VERSION_4),y)
$(info Defaulting to kernel 3.x)
KERNEL_VERSION_3=y
endif

ifeq ($(KERNEL_VERSION_3),y)
$(info Building for kernel 3.x)
KERNEL_VERSION = 3.10
KERNEL_SITE = https://github.com/gtxaspec/openipc_linux
KERNEL_BRANCH = ingenic-t31
else ifeq ($(KERNEL_VERSION_4),y)
$(info Building for kernel 4.x)
KERNEL_VERSION = 4.4
KERNEL_SITE = https://github.com/matteius/ingenic-t31-zrt-kernel-4.4.94
KERNEL_BRANCH = stable
endif
KERNEL_HASH = $(shell git ls-remote $(KERNEL_SITE) $(KERNEL_BRANCH) | head -1 | cut -f1)
$(info KERNEL_HASH=$(shell git ls-remote $(KERNEL_SITE) $(KERNEL_BRANCH) | head -1 | cut -f1))
THINGINO_KERNEL = $(KERNEL_SITE)/archive/$(KERNEL_HASH).tar.gz
$(info THINGINO_KERNEL=$(THINGINO_KERNEL))

ifeq ($(BR2_PACKAGE_RAPTOR_IPC),y)
STREAMER := raptor
else ifeq ($(BR2_PACKAGE_PRUDYNT_T),y)
STREAMER := prudynt
endif

SOC_MODEL_LESS_Z = $(subst z,,$(SOC_MODEL))
$(info SOC_MODEL_LESS_Z:    $(SOC_MODEL_LESS_Z))

SOC_FAMILY_CAPS = $(shell echo $(SOC_FAMILY) | tr a-z A-Z)
$(info SOC_FAMILY_CAPS:     $(SOC_FAMILY_CAPS))

# Determine project C library, set SDK C library and toolchain version
ifeq ($(BR2_TOOLCHAIN_USES_GLIBC),y)
BR2_LIBC_NAME := glibc
SDK_LIBC_NAME := glibc
else ifeq ($(BR2_TOOLCHAIN_USES_UCLIBC),y)
BR2_LIBC_NAME := uclibc
SDK_LIBC_NAME := uclibc
else ifeq ($(BR2_TOOLCHAIN_USES_MUSL),y)
BR2_LIBC_NAME := musl
SDK_LIBC_NAME := uclibc
else
# default to uClibc libs
BR2_LIBC_NAME := unknown
SDK_LIBC_NAME := uclibc
endif

ifeq ($(BR2_SOC_INGENIC_T10)$(BR2_SOC_INGENIC_T20)$(BR2_SOC_INGENIC_T21)$(BR2_SOC_INGENIC_T30),y)
SDK_LIBC_VERSION := 4.7.2
else
SDK_LIBC_VERSION := 5.4.0
endif

ifeq ($(BR2_SOC_INGENIC_T31),y)
ifeq ($(KERNEL_VERSION_4),y)
SDK_LIBC_VERSION := 4.7.2
SDK_LIBC_NAME := uclibc
SDK_VERSION := 1.1.5.2
endif
endif

$(info Building using $(BR2_LIBC_NAME) with $(SDK_LIBC_NAME) libs for GCC $(SDK_LIBC_VERSION) toolchain from $(SDK_VERSION) SDK)

export SOC_VENDOR
export SOC_FAMILY
export SOC_MODEL
export SOC_MODEL_LESS_Z
export SOC_RAM
export SENSOR_MODEL
export FLASH_SIZE
export THINGINO_KERNEL
export KERNEL_SITE
export KERNEL_BRANCH
export KERNEL_HASH
export KERNEL_VERSION
export STREAMER

ifneq ($(BR2_SOC_INGENIC_DUMMY),y)
# include makefiles from packages
include $(sort $(wildcard $(BR2_EXTERNAL)/package/*/*.mk))
endif
